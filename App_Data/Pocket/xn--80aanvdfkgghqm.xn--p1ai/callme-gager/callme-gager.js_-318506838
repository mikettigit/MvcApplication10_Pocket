$(function(){

$("#callmeform-gager .btn-gager").mouseover(function(){ //обработка прозрачности кнопки
	$(this).css({ opacity: 0.9 });
}).mouseleave(function(){
	$(this).css({ opacity: 1 });
});

$(".callme_viewform-gager").click(function(){
	callmeShowFormgager();
});

$("#cme_cls-gager").click(function(){//кнопка "закрыть" 
	callmeShowFormgager();
}).mouseover(function(){
	$(this).css({ opacity: 0.8 });
}).mouseleave(function(){
	$(this).css({ opacity: 1 });
});

$("#viewform-gager").hover(function(){ 
	$(this).addClass("callmeform_hover-gager");
},function(){
	$(this).removeClass("callmeform_hover-gager");
}

);
});

function callmeShowFormgager(){ //скрываем и показываем форму
	$("#callmeform-overlay-gager").fadeToggle("fast");
	$("#callme_result-gager").html("");
}

function sendMailgager() {
	var cnt = $.Storage.get('callme-sent'); //getting last sent time from storage
	if (!cnt) { cnt = 0; }
	
	$.getJSON("/callme-gager/index.php", {
		cname: $("#cname-gager").val(), 
		cphone: $("#cphone-gager").val(), 
		ccmnt: $("#ccmnt-gager").val(), 
		ctime: cnt, 
		url: location.href 
	}, function(data) {	
		message = "<div class='" + data.cls + "'>" + data.message +"</div>";
		$("#callme_result-gager").html(message);
		
		if (data.result == "success") {
			$.Storage.set("callme-sent", data.time);
			$("#callmeform-gager .btn-gager").attr("disabled", "disabled");
			setTimeout( function(){ callmeShowFormgager(); }, 1500);
			setTimeout( function(){ $("#callmeform-gager .txt-gager").val(""); }, 2000);
		}
	});
}

$(document).ready(function(){

$("#callmeform-gager .btn-gager").click(function(){
	$("#callme_result-gager").html("<div class='sending'>Отправка...</div>");
	setTimeout( function(){ sendMailgager(); }, 2000);
	return false;
});	
});

$(document).keyup(function(a) { //обработка esc
	if (a.keyCode == 27) {
		if($("#callmeform-gager").is(":visible")) {
			callmeShowFormgager();
		}
	}
});