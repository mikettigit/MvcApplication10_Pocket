$(function(){

$("#callmeform .btn").mouseover(function(){ //обработка прозрачности кнопки
	$(this).css({ opacity: 0.9 });
}).mouseleave(function(){
	$(this).css({ opacity: 1 });
});

$(".callme_viewform").click(function(){
	callmeShowForm();
});

$("#cme_cls").click(function(){//кнопка "закрыть" 
	callmeShowForm();
}).mouseover(function(){
	$(this).css({ opacity: 0.8 });
}).mouseleave(function(){
	$(this).css({ opacity: 1 });
});

$("#viewform").hover(function(){ 
	$(this).addClass("callmeform_hover");
},function(){
	$(this).removeClass("callmeform_hover");
}

);
});

function callmeShowForm(){ //скрываем и показываем форму
	$("#callmeform-overlay").fadeToggle("fast");
	$("#callme_result").html("");
}

function sendMail() {
	var cnt = $.Storage.get('callme-sent'); //getting last sent time from storage
	if (!cnt) { cnt = 0; }
	
	$.getJSON("/callme/index.php", {
		cname: $("#cname").val(), 
		cphone: $("#cphone").val(),
		ctimecall: $("#ctimecall").val(), 
		ccmnt: $("#ccmnt").val(), 
		ctime: cnt, 
		url: location.href 
	}, function(data) {	
		message = "<div class='" + data.cls + "'>" + data.message +"</div>";
		$("#callme_result").html(message);
		
		if (data.result == "success") {
			$.Storage.set("callme-sent", data.time);
			$("#callmeform .btn").attr("disabled", "disabled");
			setTimeout( function(){ callmeShowForm(); }, 4000);
			setTimeout( function(){ $("#callmeform .txt").val(""); }, 5000);
		}
	});
}

$(document).ready(function(){

$("#callmeform .btn").click(function(){
	$("#callme_result").html("<div class='sending'>Отправка...</div>");
	setTimeout( function(){ sendMail(); }, 2000);
	return false;
});	
});

$(document).keyup(function(a) { //обработка esc
	if (a.keyCode == 27) {
		if($("#callmeform").is(":visible")) {
			callmeShowForm();
		}
	}
});


/*Пустая ссылка не кидает вверх страницы*/
$(document).ready(function () {
    $('a.no_link').on('click', function( event ) {
        event.preventDefault();
    });
});/*end  ready*/