rdsApp.config(function ($routeProvider, $locationProvider) {
	$routeProvider
		.when('/trends', {
			templateUrl: '/content/trends/trends_landing.html',
			controller: 'trendsController',
			controllerAs: 'trendsCtrl'
		}).when('/moodboards', {
			templateUrl: '/content/trends/moodboards.html',
			controller: 'trendsController',
			controllerAs: 'trendsCtrl'
		})
		.when('/trendletters', {
			templateUrl: '/content/trends/trendletters.html',
			controller: 'trendsController',
			controllerAs: 'trendsCtrl'
		})
		.when('/flipbook', {
			templateUrl: '/content/trends/flipbook.html',
			controller: 'FlipbookController',
			controllerAs: 'flipbookController'
		});
});

//rdsApp.controller('trendsController', ['$scope', '$location', '$route', '$log', '$document', 'trendsService', 'settingsService', function ($scope, $location, $route, $log, $document, trendsService, settingsService) {
rdsApp.controller('trendsController', ['$scope', '$location', '$route', '$log', '$document', 'trendsService', function ($scope, $location, $route, $log, $document, trendsService) {
	var controller = this;
	trendsService.getTrendLetters();
	$scope.trendLetterUrl = undefined;


	controller.getTrendsService = function () {
		return trendsService;
	};


	controller.openTrendLetter = function (trendLetter) {
		jQuery('#trendLetterFrame').attr("src", trendLetter.webLink);
		jQuery('#trendLetterFrame').css("height", 750);
		jQuery('#trendLetterFrame').css("width", '100%');
		$scope.frameOpen = true;
	};

	controller.closeTrendLetter = function () {
		$scope.frameOpen = false;
		jQuery('#trendLetterFrame').attr("src", "");
	};

	//controller.showTrends = function(){
	//	return settingsService.showTrends();
	//}

}]);

rdsApp.controller('FlipbookController', ['$scope', '$http', '$modal', 'articleService', 'settingsService', function ($scope, $http, $modal, articleService, settingsService) {

    $scope.flipbooks = [];

    $scope.getFlipbooks = function () {
        $http.get('/action/' + site_code + '/' + language + '/flipbooks')
            .success(function (data) {
                $scope.flipbooks = data;
            }
        );
    };
    $scope.getFlipbooks();

    $scope.showPopover = function(flipbook) {
        window.open(
            '/flipbooks/' + flipbook.name + '/index.html',
            flipbook.name,
            'directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=1260,height=768');
    };
}]);


rdsApp.service('trendsService', ['$http', '$log', function ($http, $log) {
	var service = this;
	service.trendLetters = undefined;

	service.getTrendLetters = function () {
		if (!service.trendLetters) {
			$log.debug("Getting trend letters.");
			$http.get('/action/' + site_code + '/' + language + '/catalog/trendletters').success(function (data) {
				//var trendLetters = data;
				//service.trendLetters = [];
				//
				////Testing if images aren't broken
				//angular.forEach(trendLetters, function (trendLetter, key) {
				//	$http.get(trendLetter.imageLink)
				//		.then(function imageValid() {
				//			$log.debug("Image on '" + trendLetter.imageLink + "' is valid.");
				//			service.trendLetters.push(trendLetter);
				//		}, function imageBroken() {
				//			$log.warn("Image on '" + trendLetter.imageLink + "' is broken!");
				//		});
				//});

				service.trendLetters = data;
			});
		}
	}
}]);